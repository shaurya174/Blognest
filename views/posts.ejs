<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Posts Grid | Blognest</title>
  <link rel="stylesheet" href="/css/pstyle.css">
</head>

<body>
  <%-include("partials/header.ejs")%>

    <section class="posts-section" id="postsContainer"></section>

    <div class="popup-overlay" id="popup">
      <div class="popup-box">
        <span class="close-btn" onclick="closePopup()">&times;</span>
        <div id="popupContent"></div>
      </div>
    </div>

    <footer>
      Created by Shaurya Mittal | Â© 2025 Blognest
    </footer>
  </div>

  <script id="post-data" type="application/json">
    <%- JSON.stringify(myyposts) %>
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>

  <script>
    VANTA.WAVES({
      el: "#vanta-bg",
      mouseControls: true,
      touchControls: true,
      minHeight: 100.00,
      minWidth: 100.00,
      scale: 1.00,
      scaleMobile: 1.00,
      color: 0x112233,
      shininess: 40.00,
      waveHeight: 20.00,
      waveSpeed: 0.4,
      zoom: 0.85
    });

    const posts = JSON.parse(document.getElementById("post-data").textContent);
    const container = document.getElementById('postsContainer');

    posts.forEach((post, index) => {
      const card = document.createElement('div');
      card.className = 'post-card';
      card.innerHTML = `
        <div>
          <h3>${post.title}</h3>
          <p><strong>Author:</strong> ${post.author}</p>
          <p>${post.post.slice(0, 60)}...</p>
          <p><strong>Date:</strong> ${post.date}</p>
          <div class="btn-group">
            <form action="/edit/${post.id}" method="GET" onsubmit="return confirm('Taking you to edit page')">
                <button type="submit">Edit</button>
            </form>

            <button onclick="viewPost(${index})">View</button>
            <form action="/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this post?')">
              <input type="hidden" name="id" value="${post.id}">
              <button type="submit">Delete</button>
            </form>

          </div>
        </div>
      `;

      container.appendChild(card);
    });

    function viewPost(index) {
      const post = posts[index];
      const popup = document.getElementById('popup');
      const content = document.getElementById('popupContent');
      content.innerHTML = `
        <div>
          <h2>${post.title}</h2>
          <p><strong>Author:</strong> ${post.author}</p>
          <p><strong>Date:</strong> ${post.date}</p>
          <p>${post.post}</p>
        </div>
      `;
      popup.style.display = 'flex';
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }
  </script>
</body>

</html>
